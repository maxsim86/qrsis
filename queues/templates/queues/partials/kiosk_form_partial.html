<style>
    /* --- CSS UNTUK UI KIOSK --- */
    
    .kiosk-wrapper {
        /* Tukar ke FIXED supaya sentiasa center di skrin */
        position: fixed; 
        top: 0; left: 0; right: 0; bottom: 0;
        width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        z-index: 9999; /* Pastikan ia paling atas */
        overflow-y: auto;
    }

    /* SKRIN 1: ATTRACT MODE */
    .attract-card {
        text-align: center; 
        cursor: pointer; 
        padding: 40px; 
        border-radius: 30px;
        transition: transform 0.2s ease; 
        max-width: 800px; width: 90%;
        display: flex; 
        flex-direction: column; 
        align-items: center; /* Centerkan Logo & Teks secara horizontal */
        justify-content: center; /* Centerkan secara vertical */
    }
    .attract-card:active { transform: scale(0.98); }
    
    .kiosk-logo { height: 120px; width: auto; margin-bottom: 30px; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); }
    .touch-icon { font-size: 5rem; margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
    .attract-title { font-size: 2.5rem; font-weight: 800; color: #1f2937; margin-bottom: 10px; }
    .attract-sub { font-size: 1.2rem; color: #6b7280; letter-spacing: 1px; text-transform: uppercase; margin-top: 15px; }

    /* SKRIN 2: PILIHAN SERVIS & FORM */
    .service-card {
        background: white; padding: 40px; border-radius: 25px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        width: 100%; max-width: 600px; text-align: center;
        display: none; 
        animation: slideUp 0.4s ease-out;
        position: relative;
        margin: auto; /* Pastikan card berada di tengah */
    }
    
    .form-header { font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 30px; }

    /* --- BUTANG SERVIS (CENTERED) --- */
    .btn-service {
        display: flex; 
        align-items: center; 
        
        /* UBAH DI SINI: Tukar flex-start kepada CENTER */
        justify-content: center; 
        
        padding: 20px 25px; 
        margin-bottom: 15px; 
        width: 100%;
        border: none; 
        border-radius: 20px; 
        text-align: left; /* Teks dalaman kekal kemas */
        cursor: pointer; 
        transition: transform 0.2s, box-shadow 0.2s;
        position: relative;
    }
    .btn-service:active { transform: scale(0.98); }
    
    .btn-srv-a { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
    .btn-srv-b { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
    .btn-srv-c { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; }

    .srv-icon { 
        font-size: 2rem; 
        margin-right: 20px; /* Jarak antara ikon dan teks */
        background: rgba(255,255,255,0.2); 
        width: 60px; height: 60px; /* Besarkan sikit kotak ikon */
        display: flex; align-items: center; justify-content: center; 
        border-radius: 15px; 
        flex-shrink: 0; /* Elak ikon jadi kemek */
    }
    
    .srv-text {
        display: flex;
        flex-direction: column;
        justify-content: center;
        /* Biar text align left supaya tajuk & sub-tajuk selari */
        text-align: left; 
        min-width: 180px; /* Tetapkan lebar minimum supaya nampak seimbang */
    }

    .srv-text h3 { margin: 0; font-weight: 700; font-size: 1.4rem; line-height: 1.2; }
    .srv-text p { margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9rem; }

    /* Input Nama */
    .modern-input {
        width: 100%; padding: 15px; font-size: 1.2rem; text-align: center;
        border: 2px solid #e5e7eb; border-radius: 15px; background-color: #f9fafb;
        margin-bottom: 25px; outline: none; transition: all 0.3s;
    }
    .modern-input:focus { border-color: #3b82f6; background-color: white; }
    
    .btn-cancel { 
        margin-top: 10px; background: none; border: none; 
        color: #9ca3af; cursor: pointer; font-size: 1rem;
        padding: 10px 20px;
    }
    .btn-cancel:hover { color: #6b7280; text-decoration: underline; }

    /* Animasi & Loading */
    /* Loading Indicator (Spinner untuk button) */
    .htmx-indicator { display: none; }
    .htmx-request .htmx-indicator { display: inline-block; }
    .htmx-request.btn-remote { opacity
    @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    .htmx-request .btn-service { opacity: 0.5; pointer-events: none; }
    .loader-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 20; justify-content: center; align-items: center; flex-direction: column; border-radius: 25px; }
    .htmx-request.loader-overlay { display: flex; }
    .spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
</style>

<div class="kiosk-wrapper">

    <div id="attract-screen" class="attract-card" onclick="startKiosk()">
        {% if queue.logo %}
            <img src="{{ queue.logo.url }}" alt="Logo" class="kiosk-logo">
        {% endif %}
        <div class="touch-icon">üëÜ</div> 
        <div class="attract-title">Selamat Datang ke<br>{{ queue.name }}</div>
        <div class="attract-sub">Sentuh skrin untuk mula</div>
    </div>

    <div id="service-screen" class="service-card">
        
        <div id="loading-indicator" class="loader-overlay htmx-indicator">
            <div class="spinner"></div>
            <p class="mt-2 fw-bold text-muted small">Sedang memproses...</p>
        </div>

        <div class="form-header">Sila Pilih Perkhidmatan</div>

        <form hx-post="{% url 'kiosk_join' queue.slug %}" 
              hx-target="#kiosk-frame" 
              hx-swap="innerHTML"
              hx-indicator="#loading-indicator">
            
            {% csrf_token %}
            
            {% if queue.ask_input %}
                <div class="mb-3">
                    <input type="text" name="name" class="modern-input" 
                           placeholder="{{ queue.input_label|default:'Masukkan Nama Penuh' }}" 
                           autocomplete="off" id="nameInput">
                </div>
            {% endif %}

            <button type="submit" name="service_type" value="A" class="btn-service btn-srv-a">
                <div class="srv-icon">üìù</div>
                <div class="srv-text">
                    <h3>Pendaftaran</h3>
                    <p>Daftar Masuk & Rekod</p>
                </div>
            </button>

            <button type="submit" name="service_type" value="B" class="btn-service btn-srv-b">
                <div class="srv-icon">üí∞</div>
                <div class="srv-text">
                    <h3>Pembayaran</h3>
                    <p>Bayaran Yuran & Bil</p>
                </div>
            </button>

            <button type="submit" name="service_type" value="C" class="btn-service btn-srv-c">
                <div class="srv-icon">‚ùì</div>
                <div class="srv-text">
                    <h3>Pertanyaan</h3>
                    <p>Bantuan & Info Umum</p>
                </div>
            </button>

            <button type="button" class="btn-cancel" onclick="resetKiosk()">
                Batal / Kembali
            </button>
        </form>
    </div>

</div>

<script>
    function startKiosk() {
        document.getElementById('attract-screen').style.display = 'none';
        document.getElementById('service-screen').style.display = 'block';
        const input = document.getElementById('nameInput');
        if(input) setTimeout(() => input.focus(), 100);
    }

    function resetKiosk() {
        document.getElementById('service-screen').style.display = 'none';
        document.getElementById('attract-screen').style.display = 'flex';
        const input = document.getElementById('nameInput');
        if(input) input.value = '';
    }
</script>